# Mathison — Development Environment Setup

Everything that needs to be in place before the AI agent can build and test Mathison.

## Required: Provided by the User

These items cannot be created by the AI agent — the user must provide them.

### 1. LLM API Key (Anthropic)

An Anthropic API key is needed for the AI agent (Step 05+):

```bash
ANTHROPIC_API_KEY=sk-ant-...
```

**Action**: The user will provide the API key when Step 05 begins. Set it in `mathison/.env.local` at that point with `LLM_PROVIDER=anthropic`.

### 2. Kubernetes Cluster Access (kind — local)

For Steps 06-07 (K8s/Helm integration), a **kind** (Kubernetes in Docker) cluster is used. This keeps testing fully local, isolated, and automatable.

```bash
# Install kind (done by agent in Step 06)
brew install kind

# Create cluster (done by agent in Step 06)
kind create cluster --name mathison-dev

# Kubeconfig is automatically set in ~/.kube/config (kind-mathison-dev context)
```

**Why kind over the Hetzner cluster**: local = fast, no network latency, no risk of breaking shared infra, and the entire setup/teardown can be scripted for CI later.

### 3. Node.js ✅

Verified: Node.js v22.22.0, npm 11.8.0 — no action needed.

## Automatic: Handled by the AI Agent

These are set up during Step 01 — no user action needed.

| Component | How | When |
|-----------|-----|------|
| PostgreSQL 16 (pgvector) | `docker compose up -d` | Step 01 |
| Redis 7 | `docker compose up -d` | Step 01 |
| Next.js project | `create-next-app` | Step 01 |
| All npm dependencies | `npm install` | Step 01 |
| Prisma schema + migration | `npx prisma migrate dev` | Step 02 |
| shadcn/ui components | `npx shadcn@latest init` | Step 01 |
| Seed data (5 recipes) | `npx prisma db seed` | Step 04 |
| `.env.local` template | Created from `.env.example` | Step 01 |

## Environment Variables

The agent creates `mathison/.env.local` during Step 01 with these values:

```bash
# Platform
MATHISON_MODE=self-hosted
MATHISON_BASE_DOMAIN=localhost:3000

# Database (Docker Compose)
DATABASE_URL=postgresql://mathison:mathison@localhost:5432/mathison

# Redis (Docker Compose)
REDIS_URL=redis://localhost:6379

# Auth
AUTH_SECRET=<auto-generated>

# LLM — USER PROVIDES API KEY AT STEP 05
LLM_PROVIDER=anthropic
ANTHROPIC_API_KEY=<user-provided>

# Kubernetes (kind cluster — created in Step 06)
# KUBECONFIG not needed when kind sets the context automatically
```

## Directory Structure After Setup

```
ai-k8s/
├── .cursor/                        # All agent context lives here
│   ├── rules/
│   │   ├── project.mdc            # Project overview (always-applied)
│   │   ├── coding-standards.mdc   # Code conventions (always-applied)
│   │   └── memory.mdc            # Agent scratchpad (always-applied)
│   ├── tasks/                     # Step-by-step task files
│   │   ├── 01-project-bootstrap.md
│   │   ├── ...
│   │   └── 11-catalog-deployments-ui.md
│   ├── reference/                 # Real-world reference data
│   │   └── helm-values-real-world.md
│   ├── PLATFORM_PROMPT.md         # Full architecture spec
│   ├── PROGRESS.md                # Build progress tracking
│   ├── TESTING.md                 # Verification guide
│   └── DEV_SETUP.md              # This file
└── mathison/                      # The Next.js application (created in Step 01)
    ├── docker-compose.yaml
    ├── .env.local
    ├── package.json
    ├── src/
    ├── prisma/
    └── ...
```

## Port Map

| Service | Port | Notes |
|---------|------|-------|
| Next.js dev server | 3000 | `npm run dev` |
| PostgreSQL | 5432 | Docker Compose |
| Redis | 6379 | Docker Compose |
| Prisma Studio | 5555 | `npx prisma studio` |
| Ollama (if used) | 11434 | User-managed |
