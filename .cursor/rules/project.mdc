---
description: 
globs: 
alwaysApply: true
---

# Mathison — AI-First Kubernetes Platform

## The .cursor Folder Is Yours

The entire `.cursor/` directory belongs to you — the AI agent. You have full ownership:
- **Create** any file or folder that helps you work better
- **Update** any file as you learn new things or complete work
- **Delete** anything that's outdated or no longer useful
- **Reorganize** if the structure stops serving you

This is your workspace. Use it to track progress, store patterns, keep notes, manage tasks — whatever maximizes quality and efficiency. No file in `.cursor/` is sacred. Adapt it to your needs as the project evolves.

## What This Is

**Mathison** is a Next.js 16 application that lets users deploy and manage apps on Kubernetes through an AI chat agent. Users say "deploy PostgreSQL" and the agent handles Helm, namespaces, secrets, dependencies — everything. The MVP (Steps 01–11) is complete.

## Where Things Are

Everything agent-related lives under `.cursor/`:

### Rules (`.cursor/rules/`) — All context in one place

**Always applied** (loaded every message):
- `project.mdc` — this file. Project overview, conventions, session checklist.
- `coding-standards.mdc` — TypeScript, Zod v4, API patterns, component patterns.
- `memory.mdc` — runtime gotchas, package quirks, patterns that worked.

**Auto-included when relevant** (Cursor decides based on conversation context):
- `architecture.mdc` — codebase map, directory structure, modules, API routes, data flow.
- `progress.mdc` — project state, environment, known issues, decisions log.
- `dev-setup.mdc` — Docker, ports, env vars, kind cluster, test credentials.
- `testing.mdc` — E2E testing procedures, curl commands, browser verification, cleanup.

### Other files
- **Platform spec**: `.cursor/PLATFORM_PROMPT.md` — full original architecture spec (reference, read manually when needed)
- **Reference data**: `.cursor/reference/` — real-world Helm values
- **Feature planning**: `.cursor/templates/feature.md` — template for new features
- **Build archive**: `.cursor/archive/tasks/` — completed MVP build steps (historical)

## Session Startup Checklist

Every time you start a new session:

1. Context is auto-loaded: `project.mdc`, `coding-standards.mdc`, and `memory.mdc` are always applied. `architecture.mdc`, `progress.mdc`, `dev-setup.mdc`, and `testing.mdc` are auto-included when relevant.
2. If you need deep context not covered by rules, read `.cursor/PLATFORM_PROMPT.md` manually.
3. Check if Docker services are running: `docker compose -f docker-compose.local.yml ps`
4. Check if the dev server is needed: `yarn dev` (runs on port 3000)
5. Check if the worker is needed: `yarn worker` (separate terminal, needed for deployments)
6. Start building

## How You Test

- **Shell**: run `curl` against API endpoints, run `yarn typecheck`, run DB commands
- **Browser**: navigate to `http://localhost:3000`, test UI flows, fill forms, verify rendering
- **Linter**: check for TypeScript/ESLint errors after edits
- **Database**: `npx prisma studio` or `npx prisma db execute` for SQL queries
- **K8s cluster**: `kubectl --context kind-mathison-dev` to verify cluster operations

## After Completing a Feature

1. Run `yarn typecheck` and `yarn lint` — fix any errors you introduced
2. Test the feature manually (shell + browser)
3. Update `.cursor/PROGRESS.md`: note what changed, any new known issues, add decisions
4. Update `.cursor/rules/memory.mdc`: add gotchas, useful patterns, delete anything stale
5. Commit with a clear message describing the feature

## Tech Stack

- Next.js 16 (App Router), TypeScript strict, React 19
- Tailwind CSS v4, shadcn/ui, lucide-react icons
- Prisma 7 + PostgreSQL 16 (pgvector), Redis 7
- Auth.js v5 (next-auth@5 beta), Vercel AI SDK v6, BullMQ
- React Flow v12 (canvas), TanStack Query
- Helm CLI via child_process, @kubernetes/client-node
- Zod v4 (`import from "zod/v4"`)
- Package manager: **yarn**

## Key Conventions

- Server Components by default. Only `"use client"` for interactivity.
- Zod v4 for ALL validation (env vars, API inputs, tool params). Import from `"zod/v4"`.
- `@/*` path alias maps to `src/*`.
- Prisma singleton at `src/lib/db.ts`. Import from `@/generated/prisma/client` (NOT `@prisma/client`).
- Consistent API errors: `{ error: string, details?: any }` with proper HTTP codes.
- No secrets in committed files. Ever.
- App lives at workspace root (NOT inside `mathison/`).
- Docker compose file: `docker-compose.local.yml` at workspace root.
- PostgreSQL on port **5433** (5432 occupied by another project).

## K8s Testing Cluster (kind)

A local **kind** cluster is used for all K8s testing. Fully disposable and automatable.

- Create: `kind create cluster --name mathison-dev`
- Context: `kind-mathison-dev` (auto-set by kind)
- Tear down: `kind delete cluster --name mathison-dev`
- No KUBECONFIG env var needed — kind sets the kubectl context automatically

## LLM Provider

- **Anthropic** (Claude) — `LLM_PROVIDER=anthropic` in `.env.local`
