---
description: Development environment setup, Docker services, port mappings, environment variables, kind cluster setup, and test credentials. Use when setting up the dev environment, debugging infrastructure, or onboarding.
globs: 
alwaysApply: false
---

# Mathison — Development Environment Setup

Everything needed to develop and test Mathison.

## Prerequisites

| Requirement | Version | Notes |
|------------|---------|-------|
| Node.js | 22+ | Verified: v22.22.0 |
| yarn | 1.x | Verified: 1.22.22 |
| Docker | Latest | Required for postgres + redis |
| kind | Latest | K8s testing cluster |
| Helm | 4.x | `/opt/homebrew/bin/helm` |
| kubectl | Latest | `/usr/local/bin/kubectl` |

## Quick Start

```bash
# 1. Start Docker services (postgres on 5433, redis on 6379)
docker compose -f docker-compose.local.yml up -d

# 2. Install dependencies
yarn install

# 3. Run database migrations
npx prisma migrate dev

# 4. Seed the database (5 recipes)
npx prisma db seed

# 5. Start the dev server
yarn dev                    # http://localhost:3000

# 6. Start the worker (separate terminal — needed for deployments)
yarn worker

# 7. (Optional) Create/verify kind cluster for K8s testing
kind create cluster --name mathison-dev
kubectl --context kind-mathison-dev cluster-info
```

## Environment Variables

All in `.env.local` at the workspace root:

```bash
# Platform
MATHISON_MODE=self-hosted
MATHISON_BASE_DOMAIN=localhost:3000

# Database (Docker Compose — note port 5433)
DATABASE_URL=postgresql://mathison:mathison@localhost:5433/mathison

# Redis (Docker Compose)
REDIS_URL=redis://localhost:6379

# Auth
AUTH_SECRET=<auto-generated>
AUTH_URL=http://localhost:3000

# LLM
LLM_PROVIDER=anthropic
ANTHROPIC_API_KEY=<user-provided>

# Optional: for embedding generation
# OPENAI_API_KEY=<user-provided>
```

## Port Map

| Service | Port | Notes |
|---------|------|-------|
| Next.js dev server | 3000 | `yarn dev` |
| PostgreSQL | **5433** | Docker (5432 used by aucm project) |
| Redis | 6379 | Docker |
| Prisma Studio | 5555 | `npx prisma studio` |

## Test Credentials

- **Email**: admin@mathison.dev
- **Password**: admin1234
- **Workspace**: mathison-dev

## Kind Cluster

```bash
# Create
kind create cluster --name mathison-dev

# Verify
kubectl --context kind-mathison-dev cluster-info

# Ensure tenant namespace exists
kubectl --context kind-mathison-dev get ns tenant-mathison-dev

# Tear down (when done)
kind delete cluster --name mathison-dev

# Load images for testing (kind has limited Docker Hub access)
kind load docker-image bitnami/redis:latest --name mathison-dev
```
